# 📋 본인인증 서비스 연동 가이드

ConnecTone에서는 **실명 + 통신사 인증**을 통한 본인인증 시스템을 지원합니다.

## 🎯 본인인증 vs SMS 인증

### SMS 인증 (간편 인증)

- **장점**: 무료, 간단, 빠름
- **단점**: 실명 확인 불가, 통신사 확인 불가
- **적합한 경우**: 일반 커뮤니티, 소셜 서비스
- **구현**: Firebase Auth + 대체 SMS 서비스

### 본인인증 (실명 인증)

- **장점**: 실명, 생년월일, 성별, 통신사 확인 가능
- **단점**: 유료, 계약 필요
- **적합한 경우**: 금융, 결제, 중고거래, 법적 책임 필요한 서비스
- **구현**: PortOne, NICE, KCB 등

---

## 🚀 PortOne (구 아임포트) 연동 - 추천! ⭐

### 장점

- ✅ **개발자 친화적**: API가 간단하고 문서가 잘 되어 있음
- ✅ **무료 테스트**: 월 100건 무료
- ✅ **온라인 가입**: 사업자등록증만 있으면 온라인 가입 가능
- ✅ **통합 플랫폼**: 결제와 본인인증을 한 곳에서 관리
- ✅ **빠른 심사**: 1~2일 내 승인

### 가격

- **건당 200원**
- **월 100건 무료**
- **별도 가입비/월정액 없음**

---

## 📝 PortOne 설정 방법

### 1단계: 회원가입 및 계약

1. **PortOne 관리자 콘솔** 접속
   - https://admin.portone.io

2. **회원가입**
   - 이메일/비밀번호로 가입
   - 사업자 정보 입력 (사업자등록증 필요)

3. **본인인증 서비스 신청**
   - "시스템 설정" → "본인인증 설정"
   - "DANAL 본인인증" 선택 (무료 100건 포함)
   - 사업자등록증 업로드
   - 1~2일 내 승인

### 2단계: API 키 발급

1. **관리자 콘솔** → "시스템 설정" → "내 식별코드·API Keys"
2. 다음 정보 복사:
   - **가맹점 식별코드**: `imp12345678` (예시)
   - **REST API Key**: `your_api_key`
   - **REST API Secret**: `your_api_secret`

### 3단계: 환경변수 설정

`.env.local` 파일에 추가:

```bash
# PortOne 본인인증
NEXT_PUBLIC_PORTONE_IMP_CODE=imp12345678
NEXT_PUBLIC_PORTONE_API_KEY=your_api_key
PORTONE_API_SECRET=your_api_secret
```

### 4단계: 배포 및 테스트

```bash
# 빌드
npm run build

# 배포
npx firebase-tools deploy

# 테스트
# 프로필 > 계정 설정 > "본인인증 (실명 + 통신사)" 클릭
```

---

## 🧪 테스트 모드

환경변수를 설정하지 않으면 **Mock 모드**로 자동 전환됩니다.

### Mock 데이터

- **이름**: 홍길동
- **핸드폰**: 01012345678
- **생년월일**: 19900101
- **성별**: 남성
- **통신사**: SKT

### 실서비스 전환

PortOne API 키를 설정하면 자동으로 **실제 본인인증**으로 전환됩니다.

---

## 🔐 보안 및 개인정보

### 저장되는 정보

- ✅ **실명** (UserProfile.realName)
- ✅ **핸드폰 번호** (UserProfile.phoneNumber)
- ✅ **생년월일** (UserProfile.birthDate)
- ✅ **성별** (UserProfile.gender)
- ✅ **통신사** (UserProfile.carrier)
- ✅ **인증 시각** (UserProfile.certifiedAt)

### 개인정보 보호

- 🔒 Firestore 보안 규칙으로 본인만 조회 가능
- 🔒 서버 사이드에서만 검증 (API Secret 노출 방지)
- 🔒 HTTPS 통신으로 암호화
- 🔒 생년월일, 성별은 선택적으로 표시 가능

---

## 📊 다른 본인인증 서비스 비교

### NICE 본인인증

- **장점**: 업계 표준, 안정적, 금융권 신뢰도 높음
- **단점**: 계약 절차 복잡, 심사 기간 길음 (1~2주)
- **가격**: 건당 100~300원
- **계약**: 사업자등록증, 통장 사본, 법인 인감증명서 등 필요
- **웹사이트**: https://www.niceid.co.kr

### KCB 본인인증

- **장점**: 금융권 신뢰도 높음, 신용정보 연동 가능
- **단점**: 계약 절차 복잡, 심사 기간 길음 (1~2주)
- **가격**: 건당 150~350원
- **계약**: 사업자등록증, 통장 사본, 법인 인감증명서 등 필요
- **웹사이트**: https://www.kcbcredit.com

### PASS 인증

- **장점**: **무료**, 간편, PASS 앱 기반
- **단점**: 사용자가 PASS 앱 설치 필요, 연동 복잡
- **가격**: 무료
- **계약**: SKT, KT, LG U+ 각각 계약 필요
- **웹사이트**: https://www.sktelecom.com/pass

---

## 💰 비용 비교 (월 1,000건 기준)

| 서비스      | 건당 가격 | 월 비용           | 가입비    | 비고        |
| ----------- | --------- | ----------------- | --------- | ----------- |
| **PortOne** | 200원     | 180,000원         | 무료      | 100건 무료  |
| **NICE**    | 100~300원 | 100,000~300,000원 | 100,000원 | 월정액 별도 |
| **KCB**     | 150~350원 | 150,000~350,000원 | 100,000원 | 월정액 별도 |
| **PASS**    | 무료      | 무료              | 무료      | 연동 복잡   |

---

## 🛠 문제 해결

### Q1. "PortOne 라이브러리가 로드되지 않았습니다" 오류

**A**: 스크립트 로딩 타이밍 문제입니다. 페이지 새로고침 후 재시도하세요.

### Q2. "본인인증에 실패했습니다" 오류

**A**:

- API 키가 올바른지 확인
- PortOne 관리자 콘솔에서 본인인증 서비스 승인 상태 확인
- 테스트 환경에서는 Mock 모드로 전환

### Q3. Mock 모드에서 실제 인증으로 전환하려면?

**A**: `.env.local`에 PortOne API 키를 설정하고 재배포하면 자동 전환됩니다.

### Q4. 사업자등록증이 없는데 테스트하고 싶어요

**A**: 환경변수 없이 Mock 모드로 테스트 가능합니다. 실서비스는 사업자등록증 필수입니다.

---

## 📚 참고 자료

- [PortOne 본인인증 가이드](https://developers.portone.io/docs/ko/auth/guide)
- [PortOne 관리자 콘솔](https://admin.portone.io)
- [NICE 본인인증 문서](https://www.niceid.co.kr)
- [KCB 본인인증 문서](https://www.kcbcredit.com)

---

## 📞 지원

본인인증 연동 관련 문의:

- **PortOne 고객지원**: support@portone.io
- **NICE 고객지원**: 1600-1522
- **KCB 고객지원**: 02-708-1000
