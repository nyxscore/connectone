<!DOCTYPE html>
<html>
<head>
  <title>Firestore 쿼리 테스트</title>
  <script type="module">
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
    import { getFirestore, collection, query, where, getDocs } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';
    
    const firebaseConfig = {
      apiKey: "AIzaSyDy-EXIHVfzBhKcsNq93BfmQ2SQCWRszOs",
      authDomain: "connectone-8b414.firebaseapp.com",
      projectId: "connectone-8b414",
    };
    
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    
    async function testQuery() {
      console.log('=== Firestore 쿼리 테스트 시작 ===');
      
      const statusFilter = ["active", "reserved", "escrow_completed", "shipping", "shipped", "sold"];
      
      const q = query(
        collection(db, "items"),
        where("status", "in", statusFilter)
      );
      
      const snapshot = await getDocs(q);
      
      console.log('쿼리 결과:', snapshot.size, '개');
      console.log('상태별 개수:');
      
      const statusCount = {};
      snapshot.forEach(doc => {
        const status = doc.data().status;
        statusCount[status] = (statusCount[status] || 0) + 1;
        console.log(' -', doc.data().title, '[' + status + ']');
      });
      
      console.log('\n상태별 요약:');
      Object.entries(statusCount).forEach(([status, count]) => {
        console.log(status, ':', count, '개');
      });
      
      document.body.innerHTML = '<h1>결과: ' + snapshot.size + '개</h1><pre>' + JSON.stringify(statusCount, null, 2) + '</pre>';
    }
    
    window.onload = testQuery;
  </script>
</head>
<body>
  <h1>로딩 중...</h1>
</body>
</html>
